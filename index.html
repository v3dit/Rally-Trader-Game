<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Market Game</title>
</head>
<body>
    <h1>Stock Market Game</h1>
    <div>
        <h2>Your Credits: <span id="credits">0</span></h2>
        <label for="company">Select a Company:</label>
        <select id="company">
            <option value="AAPL">Apple Inc. (AAPL)</option>
            <option value="GOOGL">Alphabet Inc. (GOOGL)</option>
            <option value="MSFT">Microsoft Corporation (MSFT)</option>
            <!-- Add more options here -->
        </select>
        <label for="quantity">Quantity:</label>
        <input type="number" id="quantity" min="1">
        <button onclick="buyStock()">Buy</button>
        <button onclick="sellStock()">Sell</button>
    </div>
    <div id="portfolio">
        <!-- Portfolio items will be displayed here -->
    </div>

    <script>
        // Function to display portfolio item
        function displayPortfolioItem(symbol, quantity) {
            const portfolioDiv = document.getElementById('portfolio');
            const item = document.createElement('div');
            item.textContent = `${symbol}: ${quantity}`;
            portfolioDiv.appendChild(item);
        }

        // Function to buy stocks
        async function buyStock() {
            const username = prompt('Enter your username:');
            const symbol = document.getElementById('company').value;
            const quantity = parseFloat(document.getElementById('quantity').value);

            const response = await fetch('/buy', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, symbol, quantity })
            });

            if (response.ok) {
                alert('Stock bought successfully!');
                location.reload();
            } else {
                const errorMessage = await response.text();
                alert(errorMessage);
            }
        }

        // Function to sell stocks
        async function sellStock() {
            const username = prompt('Enter your username:');
            const symbol = document.getElementById('company').value;
            const quantity = parseFloat(document.getElementById('quantity').value);

            const response = await fetch('/sell', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ username, symbol, quantity })
            });

            if (response.ok) {
                alert('Stock sold successfully!');
                location.reload();
            } else {
                const errorMessage = await response.text();
                alert(errorMessage);
            }
        }

        // Function to load user data when the page loads
        window.onload = async () => {
            const username = prompt('Enter your username:');

            const response = await fetch(`/user/${username}`);
            if (response.ok) {
                const userData = await response.json();
                document.getElementById('credits').textContent = userData.credits;
                document.getElementById('portfolio').innerHTML = ''; // Clear previous portfolio data
                Object.keys(userData.portfolio).forEach(symbol => {
                    const quantity = userData.portfolio[symbol];
                    displayPortfolioItem(symbol, quantity);
                });
            } else {
                alert('User not found!');
            }
        };
    </script>
</body>
</html>
